{% extends 'template_base.html' %}

{% block title %}Mi cuenta{% endblock %}

{% block content %}
    <nav>
        <h4><a href="/dashboard">Inicio</a></h4>
        <ul>
            <li><a href="/logout">Cerrar sesión</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="profile-box">
            <h3>{{ current_user.Name }}</h3>
            <p>Email: {{ current_user.Email }}</p>
            <p>Rut: {{ current_user.Rut }}</p>
            <p>Rol: {{ current_user.Type }}</p>
            <div class="settings">
                <button class="one"><span>Nombre</span></button>
                <button class="two"><span>Correo Electrónico</span></button>
                <button class="three"><span>Contraseña</span></button>
            </div>
        </div>
    </div>

    <div id="name" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Actualizar nombre.</p>
            <hr />
            <div class="input-group">
                <input type="text" id="update-name" class="input" required>
                <label for="update-name" class="input-label">Nuevo nombre</label>
            </div>
            <button class="btn one" id="name-btn"><span>Actualizar</span></button>
        </div>
    </div>

    <div id="email" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Actualizar correo electrónico.</p>
            <hr />
            <div class="input-group">
                <input type="email" id="update-email" class="input" required>
                <label for="update-email" class="input-label">Nuevo correo</label>
            </div>
            <button class="btn two" id="email-btn"><span>Actualizar</span></button>
        </div>
    </div>

    <div id="password" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Actualizar contraseña.</p>
            <hr />
            <div class="input-group">
                <input type="password" id="current-password" class="input" required>
                <label for="current-password" class="input-label">Contraseña actual</label>
            </div>
            <div class="input-group">
                <input type="password" id="new-password" class="input" required>
                <label for="new-password" class="input-label">Nueva contraseña</label>
            </div>
            <button class="btn three" id="update-password"><span>Actualizar</span></button>
        </div>
    </div>

    <script>
        // Botones
        const nameButton = document.querySelector(".one")
        const emailButton = document.querySelector(".two")
        const passwordButton = document.querySelector(".three")
        // Modales
        const nameModal = document.querySelector("#name") 
        const emailModal = document.querySelector("#email") 
        const passwordModal = document.querySelector("#password")
    
        const close = document.querySelectorAll(".close")
    
        close.forEach(c => {
            c.addEventListener("click", () => {
                nameModal.style.display = "none"
                emailModal.style.display = "none"
                passwordModal.style.display = "none"
            })
        });
    
        nameButton.addEventListener("click",() => nameModal.style.display = "block") 
        emailButton.addEventListener("click",() => emailModal.style.display = "block")
        passwordButton.addEventListener("click",() => passwordModal.style.display = "block") 
    </script>

    <script>
        {
            let current_password = document.getElementById("current-password")
            let new_password = document.getElementById("new-password")

            let update_password = document.querySelector("#update-password")

            update_password.addEventListener("click", () => {
                let data = {
                    "current_password": current_password.value,
                    "new_password": new_password.value
                }

                fetch("/password",{
                    method: "POST",
                    headers: {
                        'Content-Type': "application/json"
                    },
                    body: JSON.stringify(data)
                })
                .then(res => res.json())
                .then(data => {
                    Swal.fire({
                        icon: data["ok"] ? "success" : "error",
                        text: data["message"]
                    })
                    current_password.value = ""
                    new_password.value = ""
                })

            })
        }

        {
            let email = document.getElementById("update-email")
            let email_btn = document.getElementById("email-btn")

            email_btn.addEventListener("click",() => {
                let data = {
                    "email": email.value
                }
            
                fetch("/email", {
                    method: "POST",
                    headers: {
                        'Content-Type': "application/json"
                    },
                    body: JSON.stringify(data)
                })
                .then(res => res.json())
                .then(data => {
                    Swal.fire({
                        icon: data["ok"] ? "success" : "error",
                        text: data["message"]
                    })
                    email.value = ""
                })
            })
        }

        {
            let update_name = document.getElementById("update-name")
            let name_btn = document.getElementById("name-btn")

            name_btn.addEventListener("click",() => {
                let data = {
                    "name": update_name.value
                }

                fetch("/name", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                })
                .then(res => res.json())
                .then(data => {
                    Swal.fire({
                        icon: "success",
                        text: data["message"]
                    })
                })
            })
        }

    </script>
    

{% endblock %}